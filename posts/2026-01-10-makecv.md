---
{
    "title": "makecv",
    "description": "Tiny curriculum builder.",
    "date": "January 10, 2026",
    "permalink": "/makecv/index.html",
    "layout": "default.mustache",
    "draft": true,
    "collection": "experiments"
}
---
<!--html-->
<div id="app" class="fixed top-0 left-0 w-full h-full min-h-0" style="display:none;"></div>
<div id="landing" class="w-full" style="display:none;"></div>

<script type="module">
    import kofi from "/vendor/kofi.js";

    // reference to dom containers
    const appContainer = document.querySelector(`div#app`);
    const landingContainer = document.querySelector(`div#landing`);

    // global variables
    const EVENTS = {
        INIT: "init",
        RENDER_EDITOR: "render:editor",
        RENDER_PREVIEW: "render:preview",
    };
    const LEFT_SIDE_TABS = {
        LAYERS: "tab:layers",
        ELEMENTS: "tab:elements",
    };
    const FORM_TYPES = {
        TEXT: "text",
    };
    const ELEMENT_TYPES = {
        HEADING: "heading",
        PARAGRAPH: "paragraph",
    };
    const ELEMENTS = {
        [ELEMENT_TYPES.HEADING]: {
            title: "Heading",
            description: "Bigger heading.",
            icon: "heading-1",
            fields: {
                text: {
                    type: FORM_TYPES.TEXT,
                    title: "Content",
                },
            },
        },
        [ELEMENT_TYPES.PARAGRAPH]: {
            title: "Paragraph",
            description: "Multi-line input.",
            icon: "text-left",
            fields: {
                text: {
                    type: FORM_TYPES.TEXT,
                    title: "Content",
                },
            },
        },
    };

    // renderer for form options
    const FormOptions = {
        [FORM_TYPES.TEXT]: props => {
            const className = kofi.classNames({
                "block w-full bg-white border-1 border-gray-200 px-2 py-1 h-8 text-sm rounded-lg": true,
            });
            const handleChange = event => {
                return props.onChange(event.target.value || "");
            };
            return kofi.html`
                <input type="text" className="${className}" value="${props.value}" onChange="${handleChange}" />
            `;
        },
    };

    // application components
    const ui = {
        Icon: props => kofi.html`
            <svg width="1em" height="1em">
                <svg:use href="${"/vendor/icons.svg#" + props.icon}" />
            </svg>
        `,
        Tabs: props => {
            const content = (props.items || props.tabs || []).map(tab => {
                const className = kofi.classNames({
                    "w-full text-center px-2 py-1 rounded-md leading-none": true,
                    "bg-white shadow-sm": props.value === tab.value,
                    "cursor-pointer hover:bg-white": props.value !== tab.value,
                });
                return kofi.html`
                    <div className="${className}" onClick="${() => props.onChange(tab.id || tab.value)}">
                        <span className="font-bold text-sm">${tab.name || tab.text}</span>
                    </div>
                `;
            });
            return kofi.html`
                <div className="flex items-center gap-2 w-full bg-gray-100 p-1 rounded-lg">
                    ${content}
                </div>
            `;
        },
        Logo: () => kofi.html`
            <div className="flex items-center leading-none tracking-tight gap-1 select-none">
                <div className="flex items-center">
                    ${ui.Icon({ icon: "article" })}
                </div>
                <div className="flex items-center">
                    <div className="font-bold">make</div>
                    <div className="font-light opacity-60">cv</div>
                </div>
            </div>
        `,
        Header: props => kofi.html`
            <div className="shrink-0 bg-gray-950 text-white flex flex-row items-center justify-between h-16 p-3">
                <div className="text-2xl">
                    ${ui.Logo()}
                </div>
                ${props.rightContent ? props.rightContent() : ""}
            </div>
        `,
        Form: props => kofi.html`
            <div className="flex flex-col gap-4">
                ${Object.keys(props.fields).map(field => kofi.html`
                    <div className="flex flex-col gap-1">
                        ${props.fields[field].title ? kofi.html`
                            <div className="font-bold text-sm">${props.fields[field].title}</div>
                        ` : ""}
                        ${FormOptions[props.fields[field].type]({
                            value: props.data[field],
                            disabled: false,
                            onChange: value => props.onChange(field, value),
                        })}
                    </div>
                `)}
            </div>
        `,
        LeftSideLayers: props => {
            return kofi.html`
                <div className="flex flex-col gap-2">
                    ${props.layers.map(layer => {
                        const className = kofi.classNames({
                            "w-full rounded-lg overflow-hidden flex items-center": true,
                            "bg-gray-100": layer.id === props.activeLayer,
                            "hover:bg-gray-100 cursor-pointer": layer.id !== props.activeLayer,
                        });
                        return kofi.html`
                            <div className="${className}">
                                <div className="flex items-center text-xl px-3 py-2 shrink-0">
                                    ${ui.Icon({ icon: ELEMENTS[layer.type].icon })}
                                </div>
                                <div className="font-bold text-sm pr-3 py-2 w-full">
                                    ${layer.name || layer.id}
                                </div>
                            </div>
                        `;
                    })}
                </div>
            `;
        },
        LeftSideElements: props => kofi.html`
            <div className="flex flex-col gap-4">
                ${Object.keys(ELEMENTS).map(key => kofi.html`
                    <div key="${key}" className="group flex gap-3 items-center cursor-pointer" onClick="${() => props.onClick(key)}">
                        <div className="bg-gray-100 rounded-md p-2 shrink-0 flex items-center text-xl">
                            <div className="flex group-hover:hidden items-center">
                                ${ui.Icon({ icon: ELEMENTS[key].icon})}
                            </div>
                            <div className="hidden group-hover:flex">
                                ${ui.Icon({ icon: "plus" })}
                            </div>
                        </div>
                        <div className="w-full grow-1 flex flex-col justify-center">
                            <div className="font-bold text-sm">${ELEMENTS[key].title}</div>
                            <div className="opacity-60 text-xs">${ELEMENTS[key].description}</div>
                        </div>
                    </div>
                `)}
            </div>
        `,
    };

    // create the app instance
    const app = kofi.emitter({
        [EVENTS.INIT]: () => {
            Object.assign(app.state, {
                data: {
                    elements: [
                        {
                            id: "heading01",
                            type: ELEMENT_TYPES.HEADING,
                            text: "Hello World",
                        },
                        {
                            id: "paragraph01",
                            type: ELEMENT_TYPES.PARAGRAPH,
                            text: "Hello world",
                        },
                    ],
                },
                activeElement: null,
                activeLeftSideTab: LEFT_SIDE_TABS.LAYERS,
            });
            app.state.activeElement = app.state.data.elements[0];
            appContainer.style.display = "";
            app.emit(EVENTS.RENDER_EDITOR);
        },
        [EVENTS.RENDER_EDITOR]: () => {
            const handleRemoveActiveElement = () => {
                app.state.activeElement = null; // reset active element
                app.emit(EVENTS.RENDER_EDITOR);
            };
            kofi.render(kofi.html`
                <div className="w-full h-full min-h-0 flex flex-col">
                    ${ui.Header({})}
                    <div className="grow-1 h-full w-full flex items-stretch">
                        <div className="w-full max-w-64 h-full bg-white shrink-0 border-l-1 border-gray-200">
                            <div className="w-full px-3 py-4 border-b-1 border-gray-200">
                                ${ui.Tabs({
                                    items: [
                                        { value: LEFT_SIDE_TABS.LAYERS, text: "Layers" },
                                        { value: LEFT_SIDE_TABS.ELEMENTS, text: "Elements" },
                                    ],
                                    value: app.state.activeLeftSideTab,
                                    onChange: tabValue => {
                                        app.state.activeLeftSideTab = tabValue;
                                        app.emit(EVENTS.RENDER_EDITOR);
                                    },
                                })}
                            </div>
                            ${app.state.activeLeftSideTab === LEFT_SIDE_TABS.LAYERS ? kofi.html`
                                <div className="w-full px-3 py-4 overflow-y-scroll h-full">
                                    ${ui.LeftSideLayers({
                                        layers: app.state?.data?.elements || [],
                                        activeLayer: app.state.activeElement?.id || "",
                                    })}
                                </div>
                            ` : ""}
                            ${app.state.activeLeftSideTab === LEFT_SIDE_TABS.ELEMENTS ? kofi.html`
                                <div className="w-full px-3 py-4 overflow-y-scroll h-full">
                                    ${ui.LeftSideElements({
                                        onClick: elementType => {
                                            console.log("Create", elementType);
                                        },
                                    })}
                                </div>
                            ` : ""}
                        </div>
                        <div className="w-full h-full grow-1 bg-gray-50"></div>
                        ${app.state.activeElement ? kofi.html`
                            <div className="relative w-full max-w-md h-full bg-white shrink-0 border-r-1 border-gray-200 p-3">
                                <div className="sticky top-0 w-full bg-white pb-4 flex items-center justify-between">
                                    <div className="font-bold">
                                        <span>${ELEMENTS[app.state.activeElement.type].title}</span>
                                    </div>
                                    <div className="flex text-2xl opacity:60 hover:opacity-100 cursor-pointer" onClick="${handleRemoveActiveElement}">
                                        ${ui.Icon({ icon: "x" })}
                                    </div>
                                </div>
                                ${ui.Form({
                                    data: app.state.activeElement,
                                    fields: ELEMENTS[app.state.activeElement.type].fields,
                                    onChange: (field, value) => {
                                        app.state.activeElement[field] = value;
                                        // TODO: debounce reloading preview
                                    },
                                })}
                            </div>
                        ` : ""}
                    </div>
                </div>
            `, appContainer);
        },
        [EVENTS.RENDER_PREVIEW]: () => {
            return null;
        },
    });

    // initialize the app
    app.emit(EVENTS.INIT);
</script>
<!--/html-->
